var common=common||{};(function(page){"use strict";page._updateZoomFactor=function(){var orientation="landscape";var zoom=1;if(typeof(window.orientation)!="undefined"){orientation=((screen.width/screen.height)>1)?"landscape":"portrait";zoom=document.documentElement.clientWidth/window.innerWidth;return{zoom:zoom,orient:orientation};}else{if(document.documentElement.clientWidth>document.documentElement.clientHeight){orientation="landscape";}else{orientation="portrait";}return{zoom:1,orient:orientation};}};page._getDevPixelRatio=function(){var retVal=1;if(window.devicePixelRatio){retVal=window.devicePixelRatio;}else if(screen.deviceXDPI){retVal=window.screen.deviceXDPI/window.screen.logicalXDPI;}else if("matchMedia"in window&&window.matchMedia){if(window.matchMedia("(min-resolution: 2dppx)").matches||win.matchMedia("(min-resolution: 192dpi)").matches){retVal=2;}else if(window.matchMedia("(min-resolution: 1.5dppx)").matches||window.matchMedia("(min-resolution: 144dpi)").matches){retVal=1.5;}}return retVal;};page._devPixelRatio=page._getDevPixelRatio();page._getAreaImageRatio=function(areaWidth,areaHeight,orgWidth,orgHeight){return{"width":orgWidth/areaWidth,"height":orgHeight/areaHeight};};page._createS7ParamsCover=function(areaWidth,areaHeight,orgWidth,orgHeight,zoom,pixRatio){var sizeRatio=page._getAreaImageRatio(areaWidth,areaHeight,orgWidth,orgHeight);return(sizeRatio["width"]<=sizeRatio["height"])?{"width":Math.round(areaWidth*pixRatio*zoom)}:{"height":Math.round(areaHeight*pixRatio*zoom)};};page._createS7ParamsContain=function(areaWidth,areaHeight,orgWidth,orgHeight,zoom,pixRatio){var sizeRatio=page._getAreaImageRatio(areaWidth,areaHeight,orgWidth,orgHeight);return(sizeRatio["width"]>=sizeRatio["height"])?{"width":Math.round(areaWidth*pixRatio*zoom)}:{"height":Math.round(areaHeight*pixRatio*zoom)};};page._calcBySpecifiedValue=function(specified,baseVal,zoom,pixRatio){var result=null;if(specified.indexOf("px")!=-1){result=page._calcByPixcel(specified,zoom,pixRatio);}else if(specified.indexOf("%")!=-1){result=page._calcByPercent(specified,baseVal,zoom,pixRatio);}return result;};page._calcByPixcel=function(pixStr,zoom,pixRatio){return Math.round(pixStr.substring(0,pixStr.indexOf("px"))*pixRatio*zoom);};page._calcByPercent=function(perStr,baseVal,zoom,pixRatio){var per=perStr.substring(0,perStr.indexOf("%"));return Math.round(baseVal*(per/100)*pixRatio*zoom);};page.updateBackgroundImages=function(){var zoom=page._updateZoomFactor().zoom;var pixRatio=page._devPixelRatio;$(".js-dm-bgimage").each(function(){var $elm=$(this);try{if(!$elm.data("src")){return;}var areaWidth=$elm.outerWidth();var areaHeight=$elm.outerHeight();var images=$elm.data("src").split(/,\s*/);var orgImages=$elm.data("bgimgOrg").split(/,\s*/);var orgWidths=String($elm.data("widthOrg")).split(/,\s*/);var orgHeights=String($elm.data("heightOrg")).split(/,\s*/);var bgSizes={};if($elm.data("backgroundSize")){bgSizes=$elm.data("backgroundSize").split(/,\s*/);}else{bgSizes=[$elm.css("background-size")];}var url="";for(var i=0;i<images.length;i++){if(i!=0)url+=",";url+=page._getImageUrl($elm,areaWidth,areaHeight,images[i],orgImages[i],orgWidths[i],orgHeights[i],bgSizes[i],zoom,pixRatio);}if($elm.css("background-image")!=url){$elm.css("background-image",url);}}catch(ex){console.log("updateBackgroundImages:"+ex.message);}});}
page._getImageUrl=function($elm,areaWidth,areaHeight,image,orgImage,orgWidth,orgHeight,bgSize,zoom,pixRatio){if(bgSize==null){return;}bgSize=bgSize.replace(/\s*auto$/g,"");var params={};if(bgSize==null||bgSize==""||bgSize=="auto"){params["width"]=Math.round(areaWidth*zoom);}else if(bgSize=="cover"){params=page._createS7ParamsCover(areaWidth,areaHeight,orgWidth,orgHeight,zoom,pixRatio);}else if(bgSize=="contain"){params=page._createS7ParamsContain(areaWidth,areaHeight,orgWidth,orgHeight,zoom,pixRatio);}else if(bgSize.indexOf(" ")<0){params["width"]=page._calcBySpecifiedValue(bgSize,areaWidth,zoom,pixRatio);}else if(bgSize.indexOf(" ")!=0){var widthStr=bgSize.replace(/\s+.*$/g,"");var heightStr=bgSize.replace(/^.*\s+/g,"");params["width"]=page._calcBySpecifiedValue(widthStr,areaWidth,zoom,pixRatio);params["height"]=page._calcBySpecifiedValue(heightStr,areaHeight,zoom,pixRatio);}var url=null;if((params["width"]!=null&&params["width"]>orgWidth)||(params["height"]!=null&&params["height"]>orgHeight)){url=orgImage;}else{url=image;url+=(url.indexOf("?")<0)?"?":"&";if(params["width"]!=null&&params["height"]!=null){var sizeRatio=page._getAreaImageRatio(params["width"],params["height"],orgWidth,orgHeight);if(sizeRatio["width"]<=sizeRatio["height"]){url+="wid="+params["width"];}else{url+="hei="+params["height"];}}else if(params["width"]!=null){url+="wid="+params["width"];}else if(params["height"]!=null){url+="hei="+params["height"];}else{url=orgImage;}}return"url(\""+url+"\")";}}(common.page=common.page||{}));$(document).ready(function(){var timer=false;$(window).on("load resize",function(){if(timer!==false){clearTimeout(timer);}timer=setTimeout(common.page.updateBackgroundImages,500);});});